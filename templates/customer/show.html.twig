{% extends 'base.html.twig' %}

{% block body %}

    <h1 class="text-decoration-underline">Détails du client N°{{ customer.id }}</h1>
    <div class="app-left-50 p-4">
        <div>
            <strong>Civilité :</strong> {{ customer.title }}
        </div>
        <div>
            <strong>Prenom :</strong> {{ customer.firstname }}
        </div>
        <div>
            <strong>Nom :</strong> {{ customer.lastname }}
        </div>
        <div>
            <strong>Email :</strong> {{ customer.email }}
        </div>
        <div>
            <strong>Portable :</strong> {{ customer.mobile }}
        </div>
        <div>
            <strong>Birthday :</strong> {{ customer.birthday | date('Y-m-d') }}
        </div>
        <div>
            <strong>Adresse :</strong> {{ customer.postalCode }} {{ customer.city }}
        </div>
    </div>

    <div class="app-right-50 p-4">
        <div class="float-end rounded-image">
            {% if customer.photo is not null %}
                <img src="{{ customer.photo }}" alt="Image user">
            {% else %}
                <img src="{{ asset('build/images/user_default.png') }}" alt="Image user">
            {% endif %}
        </div>
    </div>

    <div class="border-2 app-grid-container">
        <form class="mb-4" action="{{ path('customer_lists') }}" method="get" style="display: inline;">
            <button type="submit" class="btn btn-info m-3">Retour à la liste des clients</button>
        </form>
        <form class="float-end mb-4" action="{{ path('customer_edit', { id: customer.id }) }}" method="get"
              style="display: inline;">
            <button type="submit" class="btn btn-secondary m-1">Modifier</button>
        </form>

        <form class="float-end mb-4" action="{{ path('customer_delete', { id: customer.id }) }}" method="post"
              style="display: inline;"
              onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce client ?');">
            <button type="submit" class="btn btn-outline-danger m-1">Supprimer</button>
        </form>
        <hr>
    </div>

    <div class="container mt-5">
        <h1>Liste des Commandes</h1>
        <form class="float-end mb-4" action="{{ path('order_new') }}" method="get" style="display: inline;">
            <button type="submit" class="btn btn-success m-2">Ajout Order</button>
        </form>
        <table class="table table-striped table-bordered">
            <thead>
            <tr>
                {% for property in ['product_id', 'purchase_identifier', 'quantity', 'price', 'Currency', 'date'] %}
                    <th>{{ property|capitalize }}</th>
                {% endfor %}
            </tr>
            </thead>
            <tbody>
            {% for order in customer.orders %}
                <tr>
                    <td>{{ order.product.id }}</td>
                    <td>{{ order.orderDate |date('Y-m-d H:i:s') }}</td>
                    <td>{{ order.quantity }}</td>
                    <td>{{ order.price | number_format(2) }}</td>
                    <td>{{ order.currency }}</td>
                    <td>{{ order.date|date('Y-m-d H:i:s') }}</td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="7" class="text-center">Aucune commande trouvée.</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <div class="mt-3">
            {% for currency, total in totals %}
                <strong>Total {{ currency }} :</strong> {{ total | number_format(2) }} {{ currency }}<br>
            {% endfor %}
        </div>
    </div>
{% endblock %}
